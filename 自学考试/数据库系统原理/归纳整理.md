# 1.数据库系统概述

## 1.1.数据库基本概念

* 数据的概念：**数据是描述事物的符号记录**，是指用物理符号记录下来的可以鉴别的信息；
* 数据的类型：
  * 文本数据：数字，字母，特殊符号，汉字；
  * 多媒体数据：视频，音频，图像。
* 信息的概念：**信息就是对数据进行加工处理后获得的内容**，信息是有价值的，数据是杂乱无章的；
* 数据库的概念：是**长期存储**在计算机中的，**有组织**，**可共享**的数据集合；
* 数据库中存储的数据特点：永久存储，有组织，可共享；
* 数据库管理系统的概念：专门用来建立和管理数据库的一套软件，介入系统软件和应用软件之间；
* 数据库管理系统的功能：
  * **数据定义**：使用数据库定义语言DDL去创建表，视图，索引等，还可以删除和修改这些对象；
  * **数据操作**：对数据库中的数据进行增删改查操作；
  * **数据的组织，存储和管理**；
  * **数据库的创建维护**：创建数据库，管理数据库的存储空间，备份和恢复，监视数据库的性能；
  * **数据库的运行管理功能**：在数据库运行过程中，需要确保数据的安全性，完整性，并发控制以及故障恢复；
  * **其他功能**。
* 数据库系统的概念：计算机中引入数据库技术之后的系统，包括：数据库，数据库管理系统，数据库管理员，用户，应用程序。

## 1.2.数据库管理技术的发展阶段

* 人工管理阶段的特点：
  * 特点是**数据不保存**；
  * **应用程序管理数据**；
  * 数据是**面向应用的**，无共享性和独立性。
* 文件系统阶段的特点：
  * 实现了数据的**逻辑结构和物理结构的分离**，实现了数据的物理独立性；
  * 实现了数据的**长久保存**；
  * 实现了**文件级别的数据共享**；
  * 数据面向的是**特定用户**；
  * 该阶段没有实现对数据进行统一的管理和控制，所以数据冗余度大，共享性差，独立性差。
* 数据库系统阶段的特点：
  * **数据集成**：数据集成是数据库管理的主要目的，可以降低数据的冗余度，提高数据的共享性；
  * 数据**共享性好**；
  * 数据**冗余度低**；
  * 数据的**一致性**；
  * 数据**独立性高**（逻辑独立性，物理独立性）；
  * **统一的管理和控制**（安全性，完整性，并发控制，故障恢复）；
  * **减少应用程序的开发**。

## 1.3.数据库系统的结构

* 三级模式：
  * 模式：
    * 也叫做**逻辑模式**或**概念模式**，是数据库中**全体数据**的逻辑结构和特征的描述；
    * 模式其实就是一套**建库，建表**的规则，一套数据库**只能有一个模式**。
  * 外模式：
    * 也叫做**子模式**或**用户模式**，是数据库用户能够看见和操作的局部数据的逻辑结构和特征的描述，是与**某一应用**有关的数据的逻辑表示；
    * 外模式是某个用户的数据视图，模式是所有用户的公共数据视图；
    * 一个数据库可以有**多个外模式**；
    * 在数据库中提供了DDL去定义外模式，其实就是定义**视图**。
  * 内模式：
    * 也叫做**存储模式**，是对数据库中数据的**存储结构和存取方式**的描述，也是数据在数据库中的内部表现形式；
    * 一个数据库中只能有**一个内模式**；
    * 提供了DDL定义内模式的相关内容：如**索引**。
* 三级模式结构的两层映像及其作用：
  * **外模式/模式**的映像：
    * 建立的是外模式与模式间的对应关系，对于同一个模式可以有多个外模式，每个外模式与模式间都有外模式/模式映像；
    * 作用：当模式改变时，可以修改外模式/模式的映像，从而不用修改外模式，不用修改应用程序，保证了**程序与数据的逻辑独立性**。
  * **模式/内模式**的映像：
    * 建立全局的逻辑结构和物理存储结构间的对应关系，一个数据库只有一种模式和内模式，所以模式/内模式映像也是唯一的；
    * 作用：当存储结构改变时，可以修改模式/内模型的映像，使模式不用发生改变，实现了**数据与程序的物理独立性**。
* 数据库系统的运行与应用结构：
  * C/S结构：客户端/服务器；
  * B/S结构：浏览器/服务器（使用方便，维护成本低）。

## 1.4.数据模型

* 模型：是对现实世界中事物的模拟和抽象，帮助人们更好的认识和理解客观存在的事物；
* 数据模型：是对现实世界中数据特征的抽象，描述的是数据的共性内容；
* 数据的特征：
  * 静态特征：数据类型，数据长度，数据取值范围；
  * 动态特征：对数据进行的一些符合规则的操作。
* 数据模型三要素：
  * **数据结构**：数据的静态特征，数据对象的类型，数据对象的联系；
  * **数据操作**：数据的动态特征，对数据的增删改查操作；
  * **数据约束**：描述数据结构中数据间语法和语义的关联，取值范围，数据类型，是否为空。
* 数据从现实世界抽象到机器世界的过程：
  * 先将现实世界中的事物抽象为信息世界中的某一信息结构（对应于概念模型），既不依赖于计算机系统，也不依赖于数据库管理系统；
  * 然后将概念模型通过组织转换为机器世界中的某一数据库管理系统所支持的数据模型。
* 数据模型的分类：
  * 信息世界的基本概念：
    * 实体：客观存在的可相互区别的事物，如：学生，老师都是一个实体；
    * 属性：实体具有的某种特征，如：学生实体的属性就是学号，年龄，姓名，性别；
    * 码或键：可以用来唯一标识实体的属性集，如：学生实体的学号；
    * 域：属性的取值范围，如：性别分男女，分数0-100；
    * 实体型：用实体名和属性名的集合表示的同类实体，如：学生（学号、姓名、性别、年龄）；
    * 实体集：同类实体的集合，如：一个学生是实体，所有学生构成的集合就是实体集；
    * 联系：
      * 实体内的联系：指实体间各属性的关系，如：确定了学号，就可以知道该学生的姓名等其他信息。
      * 实体间的联系：一对一，一对多，多对多的联系。
  * **概念层数据模型**（使用E-R图表示实体以及实体间的联系）是数据抽象级别的最高层，是现实世界对应于信息世界的建模，这种模型与计算机系统和数据库管理系统都无关，但是它容易向数据库管理系统所支持的逻辑结构转换：
    * **实体**：**矩形**表示；
    * **属性**：**椭圆**表示；
    * **联系**：**菱形**表示；
    * 注：如果联系也存在属性，需要将属性表示出来，并使用无向边将属性与联系连接起来。
  * **逻辑层数据模型**（逻辑模型）是数据抽象的中间层，是对数据整体逻辑结构的描述，既考虑用户容易理解，又考虑数据库容易实现：
    * **层次模型**：
      * 使用树形结构去表示实体间的联系；
      * 特点：有且仅有一个根节点没有父节点；其他节点都有且仅有一个父节点；可以表示简单的实体间联系，但不适合表示复杂的联系。
    * **网状模型**：
      * 使用网状结构去表示实体间的联系；
      * 特点：可以有多个结点没有父节点，一个节点可以有多个父节点；方便比表示复杂的实体间联系，但结构复杂不易实现。
    * **关系模型**：
      * 使用二维表结构去表示实体间的联系；
      * 一对一联系，一对多联系，多对多联系。
    * 面向对象模型。
  * **物理层的数据模型**（物理模型）。



# 2.关系数据库

## 2.1.关系数据库的概述

关系数据库是以关系模型做为数据的逻辑模型，以关系做为数据组织方式的一类数据库。

* 历史：
  * **1970**年由IBM公司的CODD提出**关系模型**的概念；
  * 1972年提出了三大范式；
  * 1974年提出了BC范式。

* 数据库系统类型：
  * 实验系统：System R，Ingres
  * 商用系统：Oracle，DB2，SqlServer
  * 中小型数据库系统：MySql

## 2.2.关系数据模型

* 关系数据模型：关系数据库采用了关系数据模型作为逻辑层结构；关系数据结构，关系操作集合，关系完整性约束；
* 关系数据结构：关系数据结构指的就是关系，使用关系去表示实体间的联系；可以将关系看成是一个二维表，如学生表也叫做学生关系；
* 关系数据库中的基本术语：
  * **表**：也叫做关系，是二维的数据结构，由表名，行，列组成，表名在数据库中必须唯一；
  * **关系**：概念同表，一个关系逻辑上对应一个二维表，关系可以命名，关系的类型有基本表，视图表，查询表；
  * **列**：也叫做**属性**或**字段**，存在列名（字段名，属性名），表中的属性个数叫做元或度；
  * **属性**：概念同列，一列就是一个属性；
  * **行**：也叫做**元组**或**记录**，表中的数据就是按行存储的；
  * **元组**：概念同行，一行就是一个元组；
  * **分量**：**元组**中的一个**属性值**就是一个分量；
  * **码或键**：能用来唯一标识一个实体的属性集；
  * **超码或超键**：如果一个关系的码移除某个属性后仍然是这个关系的码，那么这个码就叫做超码，如：学生表中（学号，姓名），（学号，姓名，年龄）；
  * **候选码或候选键**：若一个关系的码移除某个属性后就不再是这个关系的码，那么这个码就叫做候选码，如：学生表中（学号），（姓名，年龄，地址，身高，体重，爱好）；
  * **主码或主键**：若指定一个候选码来唯一标识一条记录，那么这个候选码就叫做主码。一个关系中主码只有一个，候选码可以有多个；
  * **全码或全键**：若一个关系中的所有属性组成的集合是这个关系的主码，那么就称该主码为全码；
  * **主属性和非主属性**：若一个关系中被包含在任意候选码中的属性，就叫做主属性，反之就是非主属性；
  * **外码或外键**：若一个关系中存在不是这个关系的主码或候选码而是另一个关系的主码的属性，那么该属性就叫做该关系的外码；
  * **参照关系和被参照关系**：以外码作为主码的关系称为被参照关系，外码所在的关系称为参照关系；
  * **域**：指的是属性的取值范围；
  * **数据类型**：标准中的每列都有数据类型，用于限制该列存放的数据；
  * **关系模式**：在关系数据库中，关系模式是型，关系是值，关系模式是二维表的结构，关系是元组的集合。

## 2.3.关系数据库对关系的的限定

并不是所有的二维表都可以称为关系，需要满足如下条件：

* 每个**属性都是不可以分解**的；
* 每一个关系必须只有一个关系模式（二维表结构），每一个关系的属性的数据类型和属性个数是相对固定的；
* 同一个关系中候选码的值是不能完全相同的；
* 在关系中**元组的顺序是可以任意交换**的；
* 在关系中**属性的顺序是可以任意交换**的。

## 2.4.关系操作的集合

* 常用关系操作：

  * 查询：并，交，差，笛卡尔积，选择，投影，连接，除；
  * 更新：增，删，改。

* 关系操作的特点：关系操作是集合操作方式，**操作对象和操作结果都是集合**，一次一集合；

* 关系操作的语言分类：

  * **关系代数语言**；
  * **关系演算语言**（元组关系演算，域关系演算）；
  * 介于关系代数和关系演算语言之间的**SQL**（结构化查询语言）：
    * 数据定义语言（DDL）；
    * 数据操作语言（DML）；
    * 数据控制语言（DCL）。

* 关系数据语言的特点：

  * 具有**完备的表达能力**；
  * 能**独立**使用，也可以**嵌入**高级编程语言使用；
  * **功能强**；
  * 是**非过程化**的集合操作语言。

* 关系代数：关系代数操作三要素：**操作对象，操作符，操作结果**。操作对象和结果都是关系，操作符分为专门的关系操作符和传统集合操作符：

  * 传统的集合操作（先假设有两个关系R1和R2）：

    * 并：R1，R2通过并运算产生新的关系R3，R3是由属于R1和R2的所有不同的元组所组成，即：R3 = R1 ∪ R2；
    * 差：R1，R2通过差运算产生新的关系R3，R3是由属于R1但不属于R2的元组所构成，即：R3 = R1 - R2；
    * 交：R1，R2通过交运算产生新的关系R3，R3是由既属于R1又属于R2的的元组所构成，即：R3 = R1 ∩ R2；
    * 笛卡尔积：R1为M元关系，R2为N元关系，R1和R2通过笛卡尔积运算产生新关系R3，此时R3是M+N元，M*N条记录，即：R3 = R1 × R2；
    * 注：在进行交，并，差运算时，要求两个关系必须具有相同的属性个数，且相应的属性具有相同的值域。

  * 专门的关系运算：

    * 选择：

      * 从指定的关系中去选择满足条件的若干元组，并组成一个新的关系；

      * F指的是条件表达式  R指的是关系名：
        $$
        σ_F(R)
        $$

      * 还可以表示为`SELECT 关系名 WHERE 条件`。

    * 投影：

      * 从指定的关系中选取指定的若干属性组成一个新的关系；

      * A指的是列名，R指的是关系名：
        $$
        π_A(R)
        $$
        
      * 还可以表示为`PROJECTION 关系名 (列名1,列名2,...)`；
      
      * 注：在做投影操作时，生成的新关系中不包含重复的元组。
      
    * 连接：

      * 将两个关系连接起来，从中选择满足条件的元组组成新的关系；
      * 表示方式：![](./assets/image-20200818174624712.png)
      * 还可以表示为`JOIN 关系1 AND 关系2 WHERE 条件 `；
      * 常用的连接：等值连接，自然连接；
      * 等值连接：比较运算符是 = ；
      * 自然连接是一种特殊的等值连接，进行等值连接的属性是相同的属性，且需要把结果中重复的列去除。

    * 除：即笛卡尔积的逆运算，R ÷ S，R和S代表参与运算的两个关系。在除运算中，若被除关系是m元关系，除关系是n元关系，则运算结果是m-n元关系。

      ![](./assets/20180702221327633.jpg)

       ![](./assets/20180702221337126.jpg)

## 2.5.关系完整性约束

* 关系完整性的概念：数据的正确性，一致性，相容性；
* 关系完整性约束的概念：也叫做关系模型的完整性规则，是对关系的某种约束，是为了在操作（增删改）数据库时确保数据的一致性，正确性，相容性；
* 关系完整性约束的分类：
  * 实体完整性约束：若属性A是关系R中的主属性，那么A的取值不能为NULL；
  * 参照完整性约束：若属性或属性集F是关系R的外键，并与关系S的主键K对应，则R中属性F的取值只有两种可能，为空或是等于S关系中K的属性值；
  * 用户定义完整性约束：反映的是某一具体应用所涉及的数据应满足的条件。
* 关系完整性约束的检验：
  * 插入操作执行检验：
    * 检验实体完整性：先检查该记录的主键是否为空，为空则不允许插入，不为空则检查该记录的主键是否存在，存在不插入，不存在则插入；
    * 检验参照完整性：先检查插入的记录的外键属性值是否存在于被参照关系的主键属性中，若存在可插入，若不存在，则将外健置空再插入；
    * 检验用户完整性：检查数据类型，取值范围等。
  * 删除操作执行检验：一般只对被参照关系检查完整性约束，如果删除被参照关系中的记录，检查记录的主键是否被被参照关系的外键使用，若没有使用直接删除，若被使用，则有三种方式：
    * 方式1：禁止删除；
    * 方式2：将参照关系中的外键置为null，再删除被参照关系的记录；
    * 方式3：级联删除，将参照关系中的外键记录和被参照关系的主键记录一同删除。
  * 修改操作执行检验：先删除，再插入。

## 2.6.关系数据库的规范化理论

* 关系模式的存储异常问题：数据冗余，插入异常，删除异常，更新异常。
* 好的关系模式应该具有的特点：数据冗余度尽可能低，没有插入删除更新异常；
* 函数依赖与关键字：
  * 函数依赖的定义：
    * 指的是属性间的对应关系；
    * 设R是一个任意给定的关系，对于R中属性X的每一个值，R中属性Y都有唯一值与之对应，则称X函数决定Y或者Y函数依赖于X，基于X->Y，X是决定因素。
  * 函数依赖的分类：
    * **完全函数依赖**：对于任意给定关系R，有X -> Y，并且对于X的任意一个真子集X‘，都有X’ !-> Y，则称Y完全函数依赖与X；
    * **部分函数依赖**：对于任意给定关系R，有X -> Y，并且对于X的任意一个真子集X‘，都有X’ -> Y，则称Y部分函数依赖与X；
    * **传递函数依赖**：对于任意给定关系R，X、Y、Z都为其中不同的属性子集，如果X -> Y，Y -> Z，Y !-> X，则称Z传递函数依赖于X；
    * 候选函数依赖：对于任意给定关系R，U是包含该关系所有属性的集合，X为U的子集，如果有U完全函数依赖于X的关系，那么称X是R的候选关键字。

## 2.7.函数依赖对关系模式的影响

* 函数依赖可能会造成关系模式的数据冗余、插入异常、删除异常、更新异常；
* 通过规范化理论去改造关系模式，将复杂的关系模式通过分级关系模式来消除其中不合适的数据依赖，从而实现解决插入、删除、更新的异常和数据冗余的问题。

## 2.8.范式

* 二维表必须要满足一定的要求才是一个关系，那么满足不同程度的要求，就称为不同的范式（NF）；
* 分类：
  * 1NF：满足最低要求的范式是第一范式，也叫做基本范式；
  * 2NF：在第一范式的基础上增加一些新要求，称为第二范式；
  * 3NF：在第二范式的基础上增加一些新要求，称为第三范式；
  * BCNF：在第三范式的基础上进行改进。
* 规范化概念：一个低一级范式的关系模式，通过模式分解为若干个高一级范式的关系模式集合，这个过程就叫做规范化；
* 注：在关系数据库中所有关系模式都必须是规范化的，至少是满足第一范式的。

### 2.8.1.第一范式

如果一个关系R中的属性都是不可再分的基本数据项，那么R满足第一范式。

### 2.8.2.第二范式

* 设R为满足1NF的关系模型，若该关系中的所有非主属性都完全函数依赖于其候选关键字，则R满足第二范式；
* 一范式转换为二范式其实就是消除了一范式中非主属性对候选关键字的部分函数依赖。

### 2.8.3.第三范式

* 设R为满足2NF的关系模型，若该关系中的所有非主属性都传递函数依赖于其候选关键字，则R满足第三范式；
* 满足第三范式的关系既没有非主属性对候选关键字的部分依赖也没有传递依赖。

### 2.8.4.BCNF

设R是任意关系，X和Y是其属性集，F为其函数依赖集，若R是3NF，其F中所有的函数依赖X->Y中的X必须包含候选关键字，则R为BCNF。即：函数依赖中的决定因素都包含一个候选关键字。



# 3.数据库设计

## 3.1.数据库设计的概述

* 数据库的生命周期：
  * 数据库的分析与设计：
    * 需求分析；
    * 概念设计；
    * 逻辑设计；
    * 物理设计。
  * 数据库的实现与操作：
    * 数据库的实现；
    * 数据库的操作与监督；
    * 数据库的修改与调整。

* 数据库设计的目标：
  * 满足应用功能的要求；
  * 良好的数据库性能：高效存取，空间节省，共享性，完整性，一致性，安全性。
* 数据库设计的内容：
  * 数据库结构设计：设计数据库的模式与子模式，包括概念结构设计、逻辑结构设计、物理结构设计（这种设计是不变的）；
  * 数据库行为设计：对数据库的操作，增删改查（这种设计是动态的）。
* 数据库设计的方法：
  * 直观设计法；
  * 规范设计法：新奥尔良设计法、基于E-R模型的设计法、基于第三范式的设计法；
  * 计算机辅助设计法：CASE工具、UML建模语言，VISIO。
* 数据库设计的过程：
  * 需求分析；
  * 结构设计；
  * 行为设计；
  * 数据库实施；
  * 数据库的运行与维护。

## 3.2.数据库设计的基本步骤

## 3.3.关系数据库设计的方法

