# 1.网络基础

# 2.应用层

# 3.传输层

1. **实现可靠数据传输的主要措施有哪些？这些措施主要用于解决哪些问题？**

   ```
   差错控制：数据传输过程差错的检验
   确认：数据是否正确接收的检验
   重传：重新发送未正确接收的数据
   序号：保证数据的按序和不重复提交
   计时器：超时机制解决数据的丢失问题
   ```

2. **UDP与TCP分别如何实现复用与分解？**

   ```
   UDP：UDP套接字（目的IP，目的端口）
   TCP：TCP套接字（源IP，源端口，目的IP，目的端口）
   ```

3. **请画出TCP报文结构，并简要说明各个字段的主要作用**

   ```
   源端口：发送方端口，目的端口：接收方端口，序号：所封装的数据首字节序号，确认序号：期望从对方接收的下一个字节的序号，首部长度，保留字段：ACK、SYN、FIN 、 …，接收窗口：滑动窗口，紧急指针：，选项：，填充：，数据：应用层字节数据。
   ```

4. **请说明TCP建立连接与断开连接的过程，并给出主要状态转移。**

   ```
   三次握手：C发送SYN(SYN=1,seq=x)段，从CLOSE进入SYN_SEND；S接收后发送SYNACK(SYN=1,ACK=1,seq=y,ack_seq=x+1),从LISTEN进入SYN_RCVD;C接收后发送ACK(ACK=1,seq=x+1,ack_seq=y+1)段,进入ESTABLISHED,S接收后也进入ESTABLISHED状态
   
   四次挥手：C发送FIN(FIN=1,seq=u)段，从ESTABLISHED进入FIN_WAIT_1状态，C此时不能发只能收；S收到后发送ACK(ACK=1，seq=v,ack_seq=u+1)段，从ESTEBLISHED进入CLOSE_WAIT状态，S此时只发不收，C收到后进入FIN_WAIT_2状态；S发送FIN(FIN=1,ACK=1,seq=w,ack_seq=u+1),进入LAST_WAIT状态，S此时不再发送数据；C收到后发送ACK段(ACK=1,seq=u+1,seq_ack=w+1),进入TIME_WAIT状态，过2msl进入CLOSE状态，S收到数据后也进入CLOSE状态。
   ```

5. **TCP如果保证可靠数据传输？**

   ```
   基于滑动窗口协议，机制包括差错控制、确认、序号、重传、计时器。分组，计时器，校验和，排序，去重。
   ```

6. **TCP如何实现拥塞控制？**

   ```
   通过TCP拥塞窗口实现，慢启动和拥塞避免两个阶段：
   1.慢启动阶段：拥塞窗口每次接收确认都会增加1MSS，也就是说每经过1RTT都会扩增一倍；
   2.拥塞避免阶段：此时拥塞窗口每经过一个RTT才会增加1MSS。
   ```

7. **假设甲乙双方采用GBN协议发送报文段，甲已经发送了编号为0~7的报文段。当计时器超时时，若甲只收到0号和3号报文段的确认，则甲需要重发的报文段是哪些？**

   ```
   根据GBN累计确认的模式，只会重发最后一个正确接收的信息帧之后的未被确认的帧：4、5、6、7
   ```

8. **主机甲与主机乙之间已经建立一条TCP连接，主机甲向主机乙发送了两个连续的TCP段，分别包含300字节和500字节的有效载荷，第一个段的序列号是200，主机乙正确收到两个段后，发送给主机甲的确认序列号是多少？**

   ```
   第一段开始序号是200，tcp从200开始为每个字节进行编号，连续发送的两个tcp段：200~499，500~999，所以两段发送后的确认序号是1000。
   ```

9. **主机甲与主机乙之间已建立一个TCP连接，主机甲向主机乙发送了3个连续的TCP报文段，分别包含300字节、400字节和500字节的有效载荷，第3个段的序号为900。若主机乙仅正确接收到第1和第3个报文段，则主机乙发送给主机甲的确认序号是多少？**

   ```
   第3段的序号是900，前两段连续报文段序号为700，所以起始序号为200，此时为了重新构建主机A的数据流，仍需等待未正确接收的第2个报文段，所以从200~499是第2段的序号，乙发送的确认序号是500。
   ```

10. **主机甲与主机乙之间已建立一个TCP连接，双方持续有数据传输，且数据无差错与丢失。若甲收到1个来自乙的TCP段，该段的序号为1913、确认序号为 2046、有效载荷为100字节，则甲立即发送给乙的TCP段的序号和确认序号分别是多少？**

    ```
    乙发送的确认序号为2046，即期望获得的下一个字节序号为2046，所以甲发送的TCP序号为2046；
    乙发送的序号为1913，载荷为100byte，所以甲发送的TCP确认序号是2013。
    ```

11. **主机甲乙通过128kbit/s卫星信道互连，采用滑动窗口协议发送数据，链路单向传播时延250ms，分组长度为1000字节。不考虑确认分组的开销，为使信道利用率不小于80%，分组序号的位数至少要达到多少位？**

    ```
    链路带宽 = R = 128kbps = 128 * 10^3 = 128000bps
    单向传播时延 = dp = 250ms = 0.25s
    分组长度 = 1000byte = 1000 * 8 = 8000bit
    滑窗协议信道利用率 = Usender = Ws * tseg / (tseg + RTT + tack) = 80% = 0.8
    分组传输时延 = tseg = dt = L/R = 8000 / 128000 ≈ 0.06
    RTT = dp + dt = 0.25 + 0.06 = 0.31
    窗口大小 = Ws = 0.8 * (dt + RTT) / dt = 0.8 * 0.37 / 0.06 ≈ 4
    ```

12. **若甲乙之间已建立一条TCP连接，拥塞控制处于拥塞避免阶段，阈值为8 MSS，当甲的拥塞窗口大小为24 MSS时发生了超时，则甲的拥塞窗口和阈值将分别调整为多少？**

    ```
    因为是计时器超时发生的网络拥塞，所以拥塞控制进入慢启动阶段，此时拥塞窗口为1MSS，阈值重新调整为超时窗口的一半即12MSS。
    ```

13. **主机甲和主机乙已建立了TCP连接，甲始终以MSS=1 KB大小的报文段发送数据，并一直有数据发送；乙每收到一个报文段都会发出一个接收窗口为10 KB的确认段。若甲在t时刻发生超时时拥塞窗口为8 KB，则从t时刻起，不再发生超时的情况下，经过10个RTT后，甲的发送窗口是多少？**

    ```
    阈值减半为4kb，进入慢启动阶段，经过2次RTT窗口为4kb进入拥塞避免阶段，加上剩余8次RTT的8kb = 12kb
    发送窗口 = min{接收窗口,拥塞窗口} = min{10kb,12kb} = 10kb
    ```

14. **主机甲和主机乙之间已建立了一个TCP连接，TCP最大段长度为1000字节。若主机甲的当前拥塞窗口为4000字节，在主机甲向主机乙连续发送两个最大段后，成功收到主机乙发送的对第一个段的确认段，确认段中通告的接收窗口大小为2000字节，则此时主机甲还可以向主机乙发送的最大字节数是多少？**

    ```
    TCP最大段1000字节，甲的拥塞窗口4000字节，说明可以连续发送4个TCP最大段；
    甲连续发送两段1000字节后，收到对第一段1000字节的确认，并通告接收窗口2000字节，除去第二段已经发送的1000字节，甲还能向乙再发送1000字节的数据。
    ```

15. **假设主机A向主机B发送5个连续的报文段，主机B对每个报文段进行确认，其中第二个报文段丢失，其余报文段以及重传的第二个报文段均被主机B正确接收，主机A正确接收所有ACK报文段；报文段从1开始依次连续编号（即1、2、3……），主机A的超时时间足够长。请回答下列问题：**

    1. **如果分别采用GBN、SR和TCP协议，则对应这三个协议，主机A分别总共发了多少个报文段？主机B分别总共发送了多少个ACK？它们的序号是什么？(针对3个协议分别给出解答）**

       ```
       GBN：
       	主机A总共发送9个报文段：若第二个报文段丢失，那么2，3，4，5会重新传，所以1，2，3，4，5，2，3，4，5；
       	主机B总共发送8个ACK段：第二个丢失不发，其他每收到一个发一个ACK，所以1，3，4，5，2，3，4，5。
       SR：
       	主机A总共发送6个报文段：只会重传丢失的2，所以1，2，3，4，5，2；
       	主机B总共发送5个ACK段：第二个丢失不发，其他每收到一个发一个ACK，所以1，3，4，5，2。
       TCP：
       	主机A总共发送6个报文段：只会重传丢失的2，所以1，2，3，4，5，2；
       	主机B总共发送9个ACK段：
       ```

    2. **如果对上述三个协议，超时时间比5RTT长得多，那么哪个协议将在最短的时间间隔内成功交付5个报文段？**

       ```
       TCP的快速重传机制，不需要等待超时就可以重传。
       ```

16. **假设A、B两个端系统通过唯一的一条8Mbps链路连接（M=10^6），该链路的双向传播时延是150ms；A通过一个TCP连接向B发送一个大文件，B的接收缓存足够大，每个TCP段最大段长度（MSS）为1500字节，TCP采用Reno版本，且总是处于拥塞避免阶段（即忽略慢启动）。请回答下列问题：**

    1. **该TCP连接能够获得的最大窗口尺寸（以TCP段数计）是多少？**

       ```
       
       ```

    2. **该TCP连接的平均窗口尺寸（以TCP段数计）和平均吞吐量（以bps计）是多少？**

       ```
       
       ```

    3. **该TCP连接的拥塞窗口从发生丢包到恢复到最大窗口尺寸要经历多长时间？**

       ```
       
       ```