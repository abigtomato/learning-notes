# 1.网络基础

1. **若发送40字节的数据帧，从开始发送到收到确认帧的时间为120ms。设信道的数据传输速率为4Kbps，采用停等协议，帧的控制信息、确认帧长及帧处理时间均忽略不计。试求出信道的传播时延：**

   ```
   数据帧长度：L = 40byte * 8 = 320bit
   开始发送到收到确认帧的时间：t = 120ms = 数据帧传播时延 + 确认帧传播时延 + 数据帧传输时延 = 2dp + dt
   信道的数据传输速率（链路带宽）：R = 4000bit/s
   数据的传输时延：dt = L/R = 320bit / 4000bps = 0.08s * 1000 = 80ms
   信道的传播时延：dp = (t - dt) / 2 = 20ms
   ```

2. **考虑两台主机A和主机B由一条带宽为R（bit/s）、长度为D（m）的链路互连，信号传播速度为V（m/s）。假设主机A从t=0时刻开始向主机B发送分组，分组长度为L位。试求：**

   1. **传播延迟（时延）：**`dp = D/V`

   2. **传输延迟：**`dt = L/R`

   3. **若忽略节点处理延迟和排队延迟，则端到端延迟T是多少？**`T = 传输时延 + 传播时延 = L/R + D/V`

   4. **若dp>dt，则t=dt时刻，分组的第一位在哪里？**

      ```
      若dp>dt：说明第一位分组没有传输到接收端，还在链路上
      解：距离主机A的V*dt（距离=速度*时间）米的链路上
      ```

   5. **若V=250 000km/s，L=512bit，R=100Mbit/s，则使时延带宽积刚好为一个分组长度（即512bit）的链路长度D是多少？**

      ```
      时延带宽积G = 传播时延dp * 链路带宽R = (D / V) * R = 512bit
      链路长度D = G * V / R = 512bit * 250000000m/s / 100000000bit/s = 1280m
      ```

3. **假设主机A向主机B以存储-转发的分组交换方式发送一个大文件。主机A到达主机B的路径上有3段链路，其速率分别是R1=500Kbit/s，R2=2Mbit/s，R3=1Mbit/s。试求：**

   1. **假设网络没有其他流量，则该文件传送的吞吐量是多少？**`吞吐量约等于瓶颈链路的带宽：500kbps`

   2. **假设文件大小为4MB，则传输该文件到主机B大约需要多少时间？**

      ```
      忽略传播时延，需要的时间等于
      分组大小除以瓶颈链路的带宽：T = 4 × 8 × 10^6 / (500 × 10^3) = 6.4s
      ```

4. **假设主机A向主机B发送一个L=1500B的分组，主机A到达主机B的路径上有3段链路、2个分组交换机，3段链路的长度分别为D1=5000km、D2=4000km，D3=1000km；每段链路的传输速率均为R=2Mbit/s，信号传播速度为V=250000km/s，分组交换机处理每个分组的时延为dc=3ms。试求：**

   1. **若以存储-转发的分组交换方式，则该分组从主机A到达主机B的端到端时延是多少？**

      ```
      端到端时延 = 3段链路的传输时延 + 3段链路的传播时延 + 2个分组交换机的处理时延 = 3 * (L/R) + (D1 + D2 + D3) / V + 2 * dc = 3 * ((1500 * 8) / (2 * 10^6)) + ((5000 * 10^3) + (4000 * 10^3) + (1000 * 10^3)) / (250000 * 10^3) + 2 * 3ms / 1000 = 0.064s = 64ms
      ```

   2. **若dc=0，且不采取存储-转发的分组交换方式，而是分组交换机直接转发收到的每个分组（即直通交换），则该分组从主机A到达主机B的端到到时延是多少？**`64ms - 2 * 3ms = 58ms`

5. **如下图所示的网络。A在t=0时刻开始向C发送一个2Mbits的文件；B在t=0.1+e秒（e为无限趋近于0的小正实数）向D发送一个1Mbits的文件。忽略传播延迟和结点处理延迟。（注：k=10^3，M=10^6）请回答下列问题：**

   ![image-20200816172830044](assets/image-20200816172830044.png)

   1. **如果图中网络采用存储-转发的报文交换方式，则A将2Mbit的文件交付给C需要多长时间？B将1Mbit的文件交付给D需要多长时间？**

   ```
   由于采用了报文交换的方式，A的报文先到达第一个路由器，所以A的报文在路由器的队列中排在B的报文前面
   由于忽略了传播延迟和结点处理延迟，所以只考虑传输时延和排队时延
   A交付时间 = 第一段链路传输时延 + 第二段链路传输时延 + 第三段链路传输时延 = 2/10 + 2/20 + 2/10 = 0.5s = 500ms
   B交付时间 = 第一段链路传输时延 + 排队时延（A的第二段链路传输时延）+ 第二段链路传输时延 + 第三段链路传输时延 = 1/10 + 2/20 + 1/20 + 1/10 = 0.35s = 350ms
   ```

   2. **如果图中网络采用存储-转发方式的分组交换，分组长度为等长的1kbits，且忽略分组头开销以及报文的拆装开销，则A将2Mbits的文件交付给C需要大约多长时间？B将1Mbits的文件交付给D需要大约多长时间？**

   ```
   从t=0时刻到t=0.1s+e时刻，A发送的分组数 = 速度 * 时间 = (10^7bps * 0.1s) = 1Mbits / 1kbits = 1000个分组
   从t=0.1s时刻起与B共享连接路由器的链路，平均各共享到带宽10Mbps，A大约再用时：
   	= 第一段链路上所有分组的传播时延 * 后两段链路上最后一个分组的传播时延
   	= 剩余1000个分组 * 单个分组的传输时延 + 剩余两段链路 * 单个分组的传播时延 
   	= 1000 * 1000/10*10^6 + 2 * 1000/10*10^6 
   	= 0.1002s，交付剩余的1000个分组，故A向C交付2Mbits文件大约需要0.1 + 0.1002 ≈ 0.2s
   B向D交付1Mbits文件需要时间大约为：1000 * 1000/10*10^6 + 2 * 1000/10*10^6  = 0.1002s ≈ 0.1s
   ```

   3. **报文交换与分组交换相比，哪种交换方式更公平？**`分组交换更公平`



# 2.应用层

1. **假设你在浏览某网页时点击了一个超链接，URL为 "http://www.kicker.com.cn/index.html"，且该URL对应的IP地址在你的计算机上没有缓存；文件index.html引用了8个小图像。域名解析过程中，无等待的一次DNS解析请求与响应时间记为RTTd，HTTP请求传输Web对象过程的一次往返时间记为RTTh。请回答下列问题：**

   1. **你的浏览器解析到URL对应的IP地址的最短时间是多少？ 最长时间是多少？**

      ```
      最短时间 = 请求本地域名服务器直接获取结果 = 1RTTd
      最长时间 = 请求本地域名服务器 + 请求根域名服务器 + 请求顶级域名服务器解析cn + 请求权威域名服务器解析com + 请求权威域名服务器解析kicker.com.cn = 5RTTd
      ```

   2. **若浏览器没有配置并行TCP连接，则基于HTTP1.0获取URL链接Web页完整内容（包括引用的图像，下同）需要多长时间（不包括域名解析时间，下同）？**

      ```
      http1.0属于非持久连接，每次请求都要先建立tcp连接：
      建立tcp连接 + 请求web页面 + (建立tcp连接 + 请求图像地址) * 8 = 18RTTh
      ```

   3. **若浏览器配置5个并行TCP连接，则基于HTTP1.0获取URL链接Web页完整内容需要多长时间？**

      ```
      http1.0属于非持久连接，每次请求都要先建立tcp连接：
      建立tcp连接 + 请求web页面 + 并行建立5个tcp连接 + 并行请求5个图像地址 + 并行建立3个tcp连接 + 并行请求3个图像地址 = 6RTTh
      ```

   4. **若浏览器没有配置并行TCP连接，则基于非流水模式的HTTP1.1获取URL链接Web页完整内容需要多长时间？基于流水模式的HTTP1.1获取URL链接Web页完整内容需要多长时间？**

      ```
      http1.1的持久非流水连接，只需要建立一次tcp连接：
      建立tcp连接 + 请求web页面 + 请求图像地址 * 8 = 10RTTh
      http1.1的持久流水连接，只需建立一次tcp连接，8个图像无阻塞式请求（连续请求无需等待响应）：
      建立tcp连接 + 请求web页面 + 连续请求图像地址 = 3RTTh
      ```

2. **考虑向N个对等方（用户）分发F=15 GB的一个文件。该服务器具有us=30 Mbit/s的上传速率，每个对等方的下载速度di=2 Mbit/s，上传速率为u。请分别针对客户/服务器分发模式和P2P分发模式两种情况，对于N=10、100 和 1000 以及 u=500 kbit/s、1 Mbit/s和2 Mbit/s的每种组合，绘制最小分发时间图表（注：K=10^3、M=10^6、G=10^9）。**

   ```
   n=10,u=500kbps:
   dcs = 10 * 15 * 1024 * 1024 * 1024 * 8 / 30 * 1000000
   dcs = 15 * 1024 * 1024 * 1024 * 8 / 500 * 1000
   ```

   | 客户-服务器模式 |       |   N    |         |
   | :-------------: | :---: | :----: | :-----: |
   |        u        |  10   |  100   |  1000   |
   |     500kbps     | 7500s | 50000s | 500000s |
   |      1Mbps      | 7500s | 50000s | 500000s |
   |      2Mbps      | 7500s | 50000s | 500000s |

   | P2P 模式 |       |   N    |        |
   | :------: | :---: | :----: | :----: |
   |    u     |  10   |  100   |  1000  |
   | 500kbps  | 7500s | 18750s | 28302s |
   |  1Mbps   | 7500s | 11538s | 14563s |
   |  2Mbps   | 7500s | 7500s  | 7500s  |



# 3.传输层

1. **实现可靠数据传输的主要措施有哪些？这些措施主要用于解决哪些问题？**

   ```
   差错控制：数据传输过程差错的检验
   确认：数据是否正确接收的检验
   重传：重新发送未正确接收的数据
   序号：保证数据的按序和不重复提交
   计时器：超时机制解决数据的丢失问题
   ```

2. **UDP与TCP分别如何实现复用与分解？**

   ```
   UDP：UDP套接字（目的IP，目的端口）
   TCP：TCP套接字（源IP，源端口，目的IP，目的端口）
   ```

3. **请画出TCP报文结构，并简要说明各个字段的主要作用**

   ```
   源端口：发送方端口，目的端口：接收方端口，序号：所封装的数据首字节序号，确认序号：期望从对方接收的下一个字节的序号，首部长度，保留字段：ACK、SYN、FIN 、 …，接收窗口：滑动窗口，紧急指针：，选项：，填充：，数据：应用层字节数据。
   ```

4. **请说明TCP建立连接与断开连接的过程，并给出主要状态转移。**

   ```
   三次握手：C发送SYN(SYN=1,seq=x)段，从CLOSE进入SYN_SEND；S接收后发送SYNACK(SYN=1,ACK=1,seq=y,ack_seq=x+1),从LISTEN进入SYN_RCVD;C接收后发送ACK(ACK=1,seq=x+1,ack_seq=y+1)段,进入ESTABLISHED,S接收后也进入ESTABLISHED状态。
   
   四次挥手：C发送FIN(FIN=1,seq=u)段，从ESTABLISHED进入FIN_WAIT_1状态，C此时不能发只能收；S收到后发送ACK(ACK=1，seq=v,ack_seq=u+1)段，从ESTEBLISHED进入CLOSE_WAIT状态，S此时只发不收，C收到后进入FIN_WAIT_2状态；S发送FIN(FIN=1,ACK=1,seq=w,ack_seq=u+1),进入LAST_WAIT状态，S此时不再发送数据；C收到后发送ACK段(ACK=1,seq=u+1,seq_ack=w+1),进入TIME_WAIT状态，过2msl进入CLOSE状态，S收到数据后也进入CLOSE状态。
   ```

5. **TCP如果保证可靠数据传输？**

   ```
   基于滑动窗口协议，机制包括差错控制、确认、序号、重传、计时器。分组，计时器，校验和，排序，去重。
   ```

6. **TCP如何实现拥塞控制？**

   ```
   通过TCP拥塞窗口实现，慢启动和拥塞避免两个阶段：
   1.慢启动阶段：拥塞窗口每次接收确认都会增加1MSS，也就是说每经过1RTT都会扩增一倍；
   2.拥塞避免阶段：此时拥塞窗口每经过一个RTT才会增加1MSS。
   ```

7. **假设甲乙双方采用GBN协议发送报文段，甲已经发送了编号为0~7的报文段。当计时器超时时，若甲只收到0号和3号报文段的确认，则甲需要重发的报文段是哪些？**

   ```
   根据GBN累计确认的模式，只会重发最后一个正确接收的信息帧之后的未被确认的帧：4、5、6、7
   ```

8. **主机甲与主机乙之间已经建立一条TCP连接，主机甲向主机乙发送了两个连续的TCP段，分别包含300字节和500字节的有效载荷，第一个段的序列号是200，主机乙正确收到两个段后，发送给主机甲的确认序列号是多少？**

   ```
   第一段开始序号是200，tcp从200开始为每个字节进行编号，连续发送的两个tcp段：200~499，500~999，所以两段发送后的确认序号是1000。
   ```

9. **主机甲与主机乙之间已建立一个TCP连接，主机甲向主机乙发送了3个连续的TCP报文段，分别包含300字节、400字节和500字节的有效载荷，第3个段的序号为900。若主机乙仅正确接收到第1和第3个报文段，则主机乙发送给主机甲的确认序号是多少？**

   ```
   第3段的序号是900，前两段连续报文段序号为700，所以起始序号为200，此时为了重新构建主机A的数据流，仍需等待未正确接收的第2个报文段，所以从200~499是第2段的序号，乙发送的确认序号是500。
   ```

10. **主机甲与主机乙之间已建立一个TCP连接，双方持续有数据传输，且数据无差错与丢失。若甲收到1个来自乙的TCP段，该段的序号为1913、确认序号为 2046、有效载荷为100字节，则甲立即发送给乙的TCP段的序号和确认序号分别是多少？**

    ```
    乙发送的确认序号为2046，即期望获得的下一个字节序号为2046，所以甲发送的TCP序号为2046；
    乙发送的序号为1913，载荷为100byte，所以甲发送的TCP确认序号是2013。
    ```

11. **主机甲乙通过128kbit/s卫星信道互连，采用滑动窗口协议发送数据，链路单向传播时延250ms，分组长度为1000字节。不考虑确认分组的开销，为使信道利用率不小于80%，分组序号的位数至少要达到多少位？**

    ```
    链路带宽 = R = 128kbps = 128 * 10^3 = 128000bps
    单向传播时延 = dp = 250ms = 0.25s
    分组长度 = 1000byte = 1000 * 8 = 8000bit
    滑窗协议信道利用率 = Usender = Ws * tseg / (tseg + RTT + tack) = 80% = 0.8
    分组传输时延 = tseg = dt = L/R = 8000 / 128000 ≈ 0.06s
    一次请求的往返时间RTT = dp * 2 = 0.5s
    窗口大小 = Ws = 0.8 * (dt + RTT) / dt = 0.8 * 0.56 / 0.06 ≈ 7
    若使用GBN协议，则分组序号的位数k：Ws = 7 <= 2^k - 1, k = 4 
    若使用SR协议，则分组序号的位数k：Ws = 7 <= 2^(k-1), k = 4
    ```

12. **若甲乙之间已建立一条TCP连接，拥塞控制处于拥塞避免阶段，阈值为8 MSS，当甲的拥塞窗口大小为24 MSS时发生了超时，则甲的拥塞窗口和阈值将分别调整为多少？**

    ```
    因为是计时器超时发生的网络拥塞，所以拥塞控制进入慢启动阶段，此时拥塞窗口为1MSS，阈值重新调整为超时窗口的一半即12MSS。
    ```

13. **主机甲和主机乙已建立了TCP连接，甲始终以MSS=1 KB大小的报文段发送数据，并一直有数据发送；乙每收到一个报文段都会发出一个接收窗口为10 KB的确认段。若甲在t时刻发生超时时拥塞窗口为8 KB，则从t时刻起，不再发生超时的情况下，经过10个RTT后，甲的发送窗口是多少？**

    ```
    阈值减半为4kb，进入慢启动阶段，经过3次RTT（0-1，1-2，2-4）窗口为4kb进入拥塞避免阶段，加上剩余7次RTT的7kb = 11kb
    发送窗口 = min{接收窗口,拥塞窗口} = min{10kb,12kb} = 10kb
    ```

14. **主机甲和主机乙之间已建立了一个TCP连接，TCP最大段长度为1000字节。若主机甲的当前拥塞窗口为4000字节，在主机甲向主机乙连续发送两个最大段后，成功收到主机乙发送的对第一个段的确认段，确认段中通告的接收窗口大小为2000字节，则此时主机甲还可以向主机乙发送的最大字节数是多少？**

    ```
    TCP最大段1000字节，甲的拥塞窗口4000字节，说明可以连续发送4个TCP最大段；
    甲连续发送两段1000字节后，收到对第一段1000字节的确认，并通告接收窗口2000字节，除去第二段已经发送的1000字节，甲还能向乙再发送1000字节的数据。
    ```

15. **假设主机A向主机B发送5个连续的报文段，主机B对每个报文段进行确认，其中第二个报文段丢失，其余报文段以及重传的第二个报文段均被主机B正确接收，主机A正确接收所有ACK报文段；报文段从1开始依次连续编号（即1、2、3……），主机A的超时时间足够长。请回答下列问题：**

    1. **如果分别采用GBN、SR和TCP协议，则对应这三个协议，主机A分别总共发了多少个报文段？主机B分别总共发送了多少个ACK？它们的序号是什么？(针对3个协议分别给出解答）**

       ```
       GBN：
       	主机A总共发送9个报文段：若第二个报文段丢失，那么2，3，4，5会重新传，所以1，2，3，4，5，2，3，4，5；
       	主机B总共发送8个ACK段：第二个丢失不发，其他每收到一个发一个ACK，所以1，3，4，5，2，3，4，5。
       SR：
       	主机A总共发送6个报文段：只会重传丢失的2，所以1，2，3，4，5，2；
       	主机B总共发送5个ACK段：第二个丢失不发，其他每收到一个发一个ACK，所以1，3，4，5，2。
       TCP：
       	主机A总共发送6个报文段：只会重传丢失的2，所以1，2，3，4，5，2；
       	主机B总共发送5个ACK段：ack_seq=2会发送4次（1号报文成功接收后正常发送1次，快速重传机制发送3次），根据tcp累计确认的特性，最后会发送ack_seq=5。
       ```

    2. **如果对上述三个协议，超时时间比5RTT长得多，那么哪个协议将在最短的时间间隔内成功交付5个报文段？**

       ```
       TCP的快速重传机制，不需要等待超时就可以重传。
       ```

16. **假设A、B两个端系统通过唯一的一条8Mbps链路连接（M=10^6），该链路的双向传播时延是150ms；A通过一个TCP连接向B发送一个大文件，B的接收缓存足够大，每个TCP段最大段长度（MSS）为1500字节，TCP采用Reno版本，且总是处于拥塞避免阶段（即忽略慢启动）。请回答下列问题：**

    1. **该TCP连接能够获得的最大窗口尺寸（以TCP段数计）是多少？**

       ```
       设W是最大窗口尺寸，当最大发送速率超过链路带宽时会发生丢包，因此：W*MSS/RTT=8Mbps，于是W=100。
       ```

    2. **该TCP连接的平均窗口尺寸（以TCP段数计）和平均吞吐量（以bps计）是多少？**

       ```
       拥塞窗口从W/2（50）到W(100)之间变化，平均窗口尺寸:(50+100)/2=75 ；因此平均吞吐量为：75*1500*8/0.15=6Mbps。
       ```

    3. **该TCP连接的拥塞窗口从发生丢包到恢复到最大窗口尺寸要经历多长时间？**

       ```
       0.15*100/2=7.5秒，因为每个RTT窗口尺寸增加1个MSS。
       ```

