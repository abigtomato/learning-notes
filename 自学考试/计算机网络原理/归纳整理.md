# 1.计算机网络基本概念

## 1.1.网络定义

计算机网络就是以能够相互共享资源的方式互联起来的自治计算机系统的集合：

* 在不同的主机间实现快速的信息交换，通过信息交换实现硬件，软件，信息资源的共享；
* 由分布在不同地理位置的多台独立的自治计算机组成；
* 通信必须遵守共同的网络协议。

## 1.2.网络协议

网络协议就是计算机网络中的实体在进行数据交换过程中必须遵守的规则或约定：

协议三要素：

* 语法：定义实体间交换信息的格式和结构，传输信息的电平等（涉及数据及控制信息的格式，编码，电平等）；
* 语义：定义实体间交换信息和差错处理的控制信息以及对其的响应（涉及用于协调与差错处理的控制信息）；
* 时序：定义实体间交换信息的顺序以及如何匹配速度（涉及速度匹配和排序）。

## 1.3.网络分类

* 覆盖范围区分：个域网，局域网，城域网，广域网；
* 拓扑结构区分：总线型，环型，星型，树型，网状型，混合型；
* ![image-20200816140438897](assets/image-20200816140438897.png)
* 交换方式区分：电路交换网，报文交换网，分组交换网；
* 用户属性区分：公用网，私有网。

## 1.4.网络结构

* 网络边缘：指连接到网络上的所有端系统，该层功能是为用户提供服务（资源子网，信息处理）；
* 接入网络：指实现了网络边缘和网络核心连接的网络（通信子网，信息交换）；
  * 电话拨号接入；
  * 非对称数字用户线路ADSL（家庭用户接入）；
  * 混合光纤同轴电缆HFC接入网络（有线电视网络接入）；
  * 局域网（企业、学校）；
  * 移动接入网络（移动通信网络）；
* 网络核心：指由通信链路互连的分组交换设备构成的网络，实现了网络边缘中主机间的数据中继和转发（通信子网，信息交换）；
* ![image-20200816141311617](assets/image-20200816141311617.png)

## 1.5.数据交换

实现了在大规模网络核心上进行数据传输的技术基础（路由器，交换机）：

* 电路交换：建立电路连接，传输数据，拆除电路。实时性高，时延小，不适合突发性数据传输，适用于音视频通信等实时性强的业务；
* 报文交换：无连接，发送方把要发送的信息加上发送/接收主机的地址及控制信息，组成一个报文通过存储-转发的方式独立传输。时延长。
* 分组交换：将报文分成较小的数据块，每个数据块加上地址，序号等控制信息构成分组。每个分组都通过存储-转发的方式独立传输，目的地将收到的分组重新组装还原为报文。优点：
  * 交换设备存储容量要求低；
  * 交换速度快；
  * 可靠传输效率高；
  * 更加公平。

## 1.6.网络性能

* 速率：网络中单位时间内传输的数据量，称为数据传输速率，单位bit/s；

* 带宽：链路或信道能不失真的传播电磁信号的最高频率和最低频率之差，称为信道的带宽，单位HZ；当描述链路或信道的数据传输能力时，通常用带宽表示最高数据速率，单位bit/s。

* 时延：时间延迟，例如：结点处理时延，排队时延，传输时延，传播时延：

  * 传输时延：也称发送时延，指分组数据从发送端第一个到做最后一个全部发送出去所需的时间，公式：
  
  $$
  d_t = L(分组长度)/R(链路带宽)
  $$
  
  * 传播时延：指在一段信道中信号从发送端到接收端所需的时间，公式：
  
  $$
  d_p=D(物理链路长度)/V(信号传输速度)
  $$
  
* 时延带宽积：指一段物理链路的传播时延与链路带宽的乘积，公式：
  $$
  G=d_pR
  $$
  
* 丢包率：引发网络丢包的主要因素是网络拥塞，公式：
  $$
  η=N_l/N_s=(N_s-N_r)/N_s
  $$

  > Ns为发送分组总数，Nr为接收分组总数，Nl为丢失分组总数。

* 吞吐量：在单位时间内源主机通过网络向目的主机实际送达的数据量，单位bit/s，在理想情况下，吞吐量约等于瓶颈链路的带宽，公式：
  $$
  Thr=min(R1,R2,...,R_n)
  $$


例题：

* 若发送40字节的数据帧，从开始发送到收到确认帧的时间为120ms。设信道的数据传输速率为4Kbps，采用停等协议，帧的控制信息、确认帧长及帧处理时间均忽略不计。试求出信道的传播时延：

  ```
  数据帧长度：L = 40byte * 8 = 320bit
  开始发送到收到确认帧的时间：t = 120ms = 数据帧传播时延 + 确认帧传播时延 + 数据帧传输时延 = 2dp + dt
  信道的数据传输速率（链路带宽）：R = 4000bit/s
  数据的传输时延：dt = L/R = 320bit / 4000bps = 0.08s * 1000 = 80ms
  信道的传播时延：dp = (t - dt) / 2 = 20ms
  ```

* 考虑两台主机A和主机B由一条带宽为R（bit/s）、长度为D（m）的链路互连，信号传播速度为V（m/s）。假设主机A从t=0时刻开始向主机B发送分组，分组长度为L位。试求：
  * 传播延迟（时延）：`dp = D/V`
  
  * 传输延迟：`dt = L/R`
  
  * 若忽略节点处理延迟和排队延迟，则端到端延迟T是多少？`T = 传输时延+传播时延 = L/R+D/V`
  
  * 若dp>dt，则t=dt时刻，分组的第一位在哪里？
  
    ```
    若dp>dt：说明第一位分组没有传输到接收端，还在链路上
    解：距离主机A的V*dt（距离=速度*时间）米的链路上
    ```
  
  * 若V=250 000km/s，L=512bit，R=100Mbit/s，则使时延带宽积刚好为一个分组长度（即512bit）的链路长度D是多少？
  
    ```
    时延带宽积G = 传播时延dp * 链路带宽R = (D / V) * R = 512bit
    链路长度D = G * V / R = 512bit * 250000000m/s / 100000000bit/s = 1280m
    ```
  
* 假设主机A向主机B以存储-转发的分组交换方式发送一个大文件。主机A到达主机B的路径上有3段链路，其速率分别是R1=500Kbit/s，R2=2Mbit/s，R3=1Mbit/s。试求：
  * 假设网络没有其他流量，则该文件传送的吞吐量是多少？`吞吐量约等于瓶颈链路的带宽：500kbps`
  
  * 假设文件大小为4MB，则传输该文件到主机B大约需要多少时间？
  
    ```
    忽略传播时延，需要的时间等于
    分组大小除以瓶颈链路的带宽：T = 4 × 8 × 10^6 / (500 × 10^3) = 6.4s
    ```
  
* 假设主机A向主机B发送一个L=1500B的分组，主机A到达主机B的路径上有3段链路、2个分组交换机，3段链路的长度分别为D1=5000km、D2=4000km，D3=1000km；每段链路的传输速率均为R=2Mbit/s，信号传播速度为V=250000km/s，分组交换机处理每个分组的时延为dc=3ms。试求：
  * 若以存储-转发的分组交换方式，则该分组从主机A到达主机B的端到端时延是多少？
  
    ```
    端到端时延 = 3段链路的传输时延 + 3段链路的传播时延 + 2个分组交换机的处理时延 = 3 * (L/R) + (D1 + D2 + D3) / V + 2 * dc = 3 * ((1500 * 8) / (2 * 10^6)) + ((5000 * 10^3) + (4000 * 10^3) + (1000 * 10^3)) / (250000 * 10^3) + 2 * 3ms / 1000 = 0.064s = 64ms
    ```
  
  * 若dc=0，且不采取存储-转发的分组交换方式，而是分组交换机直接转发收到的每个分组（即直通交换），则该分组从主机A到达主机B的端到到时延是多少？`64ms - 2 * 3ms = 58ms`
  
* 如下图所示的网络。A在t=0时刻开始向C发送一个2Mbits的文件；B在t=0.1+e秒（e为无限趋近于0的小正实数）向D发送一个1Mbits的文件。忽略传播延迟和结点处理延迟。（注：k=10^3，M=10^6）请回答下列问题：![image-20200816172830044](assets/image-20200816172830044.png)
  * 如果图中网络采用存储-转发的报文交换方式，则A将2Mbit的文件交付给C需要多长时间？B将1Mbit的文件交付给D需要多长时间？
  
    ```
    由于采用了报文交换的方式，A的报文先到达第一个路由器，所以A的报文在路由器的队列中排在B的报文前面
    由于忽略了传播延迟和结点处理延迟，所以只考虑传输时延和排队时延
    A交付时间 = 第一段链路传输时延 + 第二段链路传输时延 + 第三段链路传输时延 = 2/10 + 2/20 + 2/10 = 0.5s = 500ms
    B交付时间 = 第一段链路传输时延 + 排队时延（A的第二段链路传输时延）+ 第二段链路传输时延 + 第三段链路传输时延 = 1/10 + 2/20 + 1/20 + 1/10 = 0.35s = 350ms
    ```
  
  * 如果图中网络采用存储-转发方式的分组交换，分组长度为等长的1kbits，且忽略分组头开销以及报文的拆装开销，则A将2Mbits的文件交付给C需要大约多长时间？B将1Mbits的文件交付给D需要大约多长时间？
  
    ```
    从t=0时刻到t=0.1s+e时刻，A发送的分组数 = 速度 * 时间 = (10^7bps * 0.1s) = 1Mbits / 1kbits = 1000个分组
    从t=0.1s时刻起与B共享连接路由器的链路，平均各共享到带宽10Mbps，A大约再用时：
    	= 第一段链路上所有分组的传播时延 * 后两段链路上最后一个分组的传播时延
    	= 剩余1000个分组 * 单个分组的传输时延 + 剩余两段链路 * 单个分组的传播时延 
    	= 1000 * 1000/10*10^6 + 2 * 1000/10*10^6 
    	= 0.1002s，交付剩余的1000个分组，故A向C交付2Mbits文件大约需要0.1 + 0.1002 ≈ 0.2s
    B向D交付1Mbits文件需要时间大约为：1000 * 1000/10*10^6 + 2 * 1000/10*10^6  = 0.1002s ≈ 0.1s
    ```
  
  * 报文交换与分组交换相比，哪种交换方式更公平？`分组交换更公平`

## 1.7.网络体系结构

* 体系结构定义：计算机网络各层次结构模型及其协议的集合。

* 层次结构：按照功能分成若干层，每层完成一部分子功能，分而治之，各个击破（不是按实现方式划分层次结构的）。

* 层次结构优点：

  * 各层间相互独立；
  * 灵活性好；
  * 结构上可分隔开；
  * 易于实现和维护；
  * 能促进网络标准化。

* 层次结构基本概念：

  * ![image-20200816150916568](assets/image-20200816150916568.png)

  * 实体：表示任何可发送或接收信息的硬件或软件进程；
  * 协议：控制两个对等实体进行通信的规则集合，协议是水平的；
  * 服务：下层为上层提供服务，上层使用下层提供的服务，服务是垂直的，下层协议的实现对上层的服务用户是透明的；
  * 接口：相邻层通过接口进行交互；
  * SAP：通过服务访问点SAP，交换原语，指定请求的特定服务。

## 1.8.OSI参考模型

OSI包括了体系结构，服务定义和协议规范三级抽象（异构网络系统互连的国际标准、理解网络通信的理论模型）：

* 物理层：使原始数据以比特流的形式在物理介质上传输（接口特性、比特编码、数据率、比特同步、传输模式）；
* 数据链路层：通过校验，确认，反馈重发等手段，将不可靠的物理链路改造成对网络层来说是无差错的数据链路，该层以帧为单位传输数据（点到点数据传输、成帧、物理寻址、流量控制、差错控制、访问控制）；
* 网络层：源主机到目的主机的数据分组交付，逻辑寻址，路由，分组转发。该层以数据包为单位传输数据（通过IP地址寻址通信）；
* 传输层：提供端到端（应用进程间）的透明数据传输服务，处理端到端的差错控制和流量控制问题。该层以数据段的形式传输数据（通过端口号寻址通信）；
* 会话层：负责建立，管理，终止进程间的会话和数据交换（会话控制，同步）；
* 表示层：负责数据的格式转换，加解密，压缩解压缩等；
* 应用层：为用户的应用进程提供网络服务。

通信过程：

![image-20200816154045983](assets/image-20200816154045983.png)

数据封装：

![image-20200816154809919](assets/image-20200816154809919.png)

## 1.9.TCP/IP参考模型

TCP/IP模型是简化的OSI参考模型，是因特网采用的标准化体系结构：

* 网络接口层：对应于OSI模型中的物理层和数据链路层（TCP/IP体系结构并没有对该层使用的协议做出强硬规定，允许主机连入网络时使用多种现成的和流行的协议）；
* 互联层：负责将源主机的报文分组发送到目的主机；
* 传输层：负责应用进程间的端到端的通信；
* 应用层：为用户提供各种网络应用服务。

![image-20200816155405710](assets/image-20200816155405710.png)

## 1.10.五层参考模型

综合OSI和TCP/IP的优点，理论模型和实际应用的结合：

* 应用层：支持各种网络应用（FTP，HTTP，SMTP）；
* 传输层：进程到进程间的数据传输（TCP，UDP）；
* 网络层：源主机到目的主机的数据分组和路由转发（IP协议，路由协议）；
* 链路层：相邻节点（主机，交换机，路由器等）的数据传输（以太网，WIFI，PPP）；
* 物理层：比特流的传输。

数据封装：

![image-20200816155933400](assets/image-20200816155933400.png)



# 2.网络应用

## 2.1.网络应用体系结构

* C/S结构：
  * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200819151505043.png" alt="image-20200819151505043" style="zoom:80%;" />
  * 网络应用的通信双方为服务器程序和客户端程序，由客户端发送请求，服务端做出响应（Web应用，FTP，电子邮件，DNS等）；
  * 服务端：
    * 7*24提供服务；
    * 永久性的访问地址和域名；
    * 利用大量服务器实现可拓展。
  * 客户端：
    * 主动与服务器通信，使用服务器提供的服务；
    * 间歇性的接入网络；
    * 可能使用动态IP地址；
    * 不会和其他客户机直接通信。
  * 主要应用：web应用，电子邮件，FTP，DNS等。
* P2P结构：
  * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200819151515570.png" alt="image-20200819151515570" style="zoom:80%;" />
  * 通信双方直接对等通信，每个对等端都既是服务器又是客户端，没有中心服务器（文件共享、文件分发、视频流服务、QQ、MSN、微信、pplive等）；
  * 没有永远在线的服务器；
  * 任意端系统/节点之间都可以直接通信；
  * 节点间歇性的接入网络；
  * 节点IP地址可改变；
  * 优点是高度可伸缩，缺点是难于管理；
  * 主要应用：文件共享，文件分发等。
* 混合结构：既有中心服务器的存在，又有对等端之间的通信。

## 2.2.网络应用通信基本原理

* 通信过程：
  * 网络应用的本身是运行在不同主机或同一主机的不同应用进程间的通信；
  * 运行在不同主机上的应用进程以C/S的方式进行通信，服务器进程被动等待客户端请求服务，客户端主动发起连接请求。
* API：应用编程接口，应用层报文通过API将报文传递给传输层，请求传输层协议提供端到端的传输服务，如：socket套接字。
* 端口号：传输层协议为请求接口的每个套接字分配一个编号来标识套接字，这个编号就是端口号。
* 网络应用进程标识：通过进程所在的主机IP地址和其套接字所绑定的端口号可以标识应用进程。
* 网络应用与传输层服务：
  * TCP（面向连接的可靠字节流传输服务）：面向连接的服务-建立一条全双工的逻辑连接，可靠的数据传输服务-无差错，有序传输；
  * UDP（无连接的不可靠数据报传输服务）。

## 2.3.网络应用对传输服务的要求

* 数据丢失/可靠性：某些网络应用如网络电话等允许一定的数据丢失，某些网络应用如文件传输等要求100%可靠的数据传输；
* 时间延迟：某些网络应用如网络游戏/网络电话等需要低延时的环境；
* 带宽：某些网络应用如网络视频需要带宽达到最低要求时才能生效，某些应用如电子邮件能够适应任何带宽。

## 2.4.网络应用通信基本原理

网络应用需要遵循应用层协议。

<img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200819155720738.png" alt="image-20200819155720738" style="zoom: 67%;" />

* 公开协议：由RFC定义（IETF组织），允许互操作，HTTP，SMTP，FTP，......；
* 私有协议：大多数的p2p文件共享应用。

## 2.5.域名系统

* DNS的功能：将用户使用的域名映射为计算机使用的IP地址的过程称为域名解析。由域名服务器提供域名解析服务（DNS使用UDP的53号端口）；
* 层次化域名结构：
  * 三级域名，二级域名，顶级域名；
  * 顶级域名分类：
    * 国家级域名（cn，us，uk等）；
    * 通用级域名（com，edu，net，org，gov，mil，int等）；
    * 基础结构域名（arpa用于反向域名解析）。
* 域名服务器：
  * 本地域名服务器（默认DNS，首先查询）；
  * 根域名服务器（13个不同IP地址的根域名服务器，由英文字母a-m命名）；
  * 顶级域名服务器；
  * 权威域名服务器（保存一个区内所有主机的域名到IP地址的映射）；
  * 中间域名服务器。

* 迭代解析：

  * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200819170630724.png" alt="image-20200819170630724"  />
  * 首先请求本地DNS；
  * 本地DNS没有则代为请求根DNS，若是根DNS也没有则由本地DNS依次代为请求顶级DNS和权威DNS，直到成功解析或无法解析。

* 递归解析：

  * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200819170639759.png" alt="image-20200819170639759"  />

  * 首先请求本地DNS；
  * 没有则代为去请求根DNS，没有则由根DNS代为请求顶级DNS，若依旧没有则依次向高层的权威域名服务器递归请求，直到解析结果依次返回。

## 2.6.Web应用

* URL（统一资源定位器）：协议类型，服务器主机域名，对象的路径名；

* HTML（超文本标记语言）；

* HTTP（超文本传输协议）：
  * HTTP特点：web应用层协议（使用TCP的80端口），定义了浏览器如何向web服务器发送请求以及web服务器如何向浏览器进行响应（http/1.0，http/1.1目前使用的主要版本，http/2.0）。
  
  * 非持久HTTP：http客户端与http服务器建立tcp连接后，通过该连接发送http请求报文，接收http响应报文，然后断开连接（http/1.0使用的就是非持久连接）；
  
  * 持久HTTP：
  
    * 非流水方式持久连接：建立一次tcp连接请求，等待其他http请求响应完成再断开；
    * 流水方式持久连接：建立一次tcp连接请求，多次相似的http请求可以并行处理。
  
  * HTTP交互过程响应时间分析（持久连接和非持久连接响应时间比较）：
  
    * 例：设用户请求一个引用了3个jpeg小图像的web页面，响应时间如下，各需要几个RTT（请求响应时间）？：
  
      * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820101715094.png" alt="image-20200820101715094" style="zoom:67%;" />
      * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820101723504.png" alt="image-20200820101723504" style="zoom:67%;" />
      * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820101727883.png" alt="image-20200820101727883" style="zoom:67%;" />
  
    * 例：假设你在浏览某网页时点击了一个超链接，URL为 "http://www.kicker.com.cn/index.html"，且该URL对应的IP地址在你的计算机上没有缓存；文件index.html引用了8个小图像。域名解析过程中，无等待的一次DNS解析请求与响应时间记为RTTd，HTTP请求传输Web对象过程的一次往返时间记为RTTh。请回答下列问题：
  
      * 你的浏览器解析到URL对应的IP地址的最短时间是多少？ 最长时间是多少？
  
        ```
        最短时间 = 请求本地域名服务器直接获取结果 = 1RTTd
        最长时间 = 请求本地域名服务器 + 请求根域名服务器 + 请求顶级域名服务器解析cn + 请求权威域名服务器解析com + 请求权威域名服务器解析kicker.com.cn = 5RTTd
        ```
  
      * 若浏览器没有配置并行TCP连接，则基于HTTP1.0获取URL链接Web页完整内容（包括引用的图像，下同）需要多长时间（不包括域名解析时间，下同）？
  
        ```
        http1.0属于非持久连接，每次请求都要先建立tcp连接：
        建立tcp连接 + 请求web页面 + (建立tcp连接 + 请求图像地址) * 8 = 18RTTh
        ```
  
      * 若浏览器配置5个并行TCP连接，则基于HTTP1.0获取URL链接Web页完整内容需要多长时间？
  
        ```
        http1.0属于非持久连接，每次请求都要先建立tcp连接：
        建立tcp连接 + 请求web页面 + 并行建立5个tcp连接 + 并行请求5个图像地址 + 并行建立3个tcp连接 + 并行请求3个图像地址 = 6RTTh
        ```
  
      * 若浏览器没有配置并行TCP连接，则基于非流水模式的HTTP1.1获取URL链接Web页完整内容需要多长时间？基于流水模式的HTTP1.1获取URL链接Web页完整内容需要多长时间？
  
        ```
        http1.1的持久非流水连接，只需要建立一次tcp连接：
        建立tcp连接 + 请求web页面 + 请求图像地址 * 8 = 10RTTh
        http1.1的持久流水连接，只需建立一次tcp连接，8个图像无阻塞式请求（连续请求无需等待响应）：
        建立tcp连接 + 请求web页面 + 连续请求图像地址 = 3RTTh
        ```
  
  * HTTP报文：
  
    * 起始行，首部行，空白行，实体主体；
    * 请求报文的起始行：`<方法><URL><协议版本>`；
    * 响应报文的起始行：`<协议版本><状态码><短语>`；
    * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820102200034.png" alt="image-20200820102200034" style="zoom:80%;" />
  
  * HTTP请求方法：
  
    * GET：请求读取由URL所标识的信息；
    * HEAD：请求读取由URL标识的信息的首部，即无需在响应报文中包含对象；
    * POST：给服务器添加信息；
    * OPTION：请求一些选项的信息；
    * PUT：在指定的URL下存储一个文件。
  
* Cookie（小型文本文件）：

  * 指某些网站为了辨别用户身份，进行会话跟踪而存储在用户本地终端上的数据；
  * cookie可以用于用户跟踪，实现在无状态的http协议上建立用户会话；
  * cookie技术主要包括4个部分：
    * http响应报文中的cookie头行：Set-Cookie；
    * 用户浏览器在本地存储，维护，管理的cookie文件；
    * http请求报文中的cookie头行：Cookie；
    * 网站在后台数据库中存储，维护cookie信息。
  * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820104158458.png" alt="image-20200820104158458" style="zoom:80%;" />

## 2.7.电子邮件

* 电子邮件系统结构：
  * 邮件服务器，SMTP，用户代理，邮件读取协议；
  * 电子邮件地址格式：用户名@邮箱所在主机的域名；
  * 用户代理：电子邮件应用的客户端软件（outlook，foxmail）。
* SMTP及其特点：
  * SMTP是电子邮件中核心应用层协议，实现邮件服务器之间或用户代理到邮件服务器之间的邮件传输，使用TCP进行可靠传输，使用25号端口；
  * 特点：
    * SMTP只能传送7bit的ASCII码文本内容，包括SMTP命令，应答消息以及邮件内容 （MIME：将非7bit的ASCII码文本转换为7bit文本内容的方案）；
    * SMTP传送的邮件内容不能包含"CRLF.CRLF"；
    * SMTP是"推动"协议；
    * SMTP使用TCP连接是持久的。
* SMTP邮件发送过程：
  * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820114215188.png" alt="image-20200820114215188" style="zoom: 67%;" />
  * 客户端主动请求与服务器建立tcp连接，服务器以220类型消息进行应答；
  * 客户端通过HELP命令向服务器发送自己的域名，服务器以250类型消息进行应答，至此完成了握手；
  * 客户端通过MAIL FROM和RCPT TO命令向服务器通告邮件发送地址和接收地址，服务器以250类型的消息分别进行响应；
  * 客户端通过DATA命令通知服务器准备开始发送邮件内容，服务器以354类型消息进行应答；
  * 客户端开始传输邮件内容，传输完成后发送"CRLF.CRLF"通知服务器邮件内容发送完毕，服务器以250类型消息进行应答；
  * 客户端发送QUIT命令请求关闭tcp连接，服务器发送221类型应答，同意结束SMTP会话并断开连接。
* 邮件读取协议（用户代理读取邮件服务器中的邮件）：
  * POP3（使用tcp的110号断开）：
    * <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820114227700.png" alt="image-20200820114227700" style="zoom:67%;" />
    * 客户端请求tcp连接，成功建立后，服务端利用"+ok pop3 server ready"进行应答；
    * 客户端使用user和pass命令完成授权；
    * 客户端发送list命令请求服务器发送邮件列表，服务器应答的邮件列表包含邮件序号和邮件长度；
    * 客户端发送retr 1命令请求服务端传输第1封邮件；
    * 客户端发送dele 1命令请求服务器为第1封邮件做删除标记；
    * 客户端发送quit命令请求服务器真正删除已标记删除的邮件，并断开连接。
  * IMAP：邮件的远程存储，存储在服务器上；
  * HTTP：读取web邮件。
* <img src="D:\workspace\learning-notes\自学考试\计算机网络原理\assets\image-20200820114141376.png" alt="image-20200820114141376" style="zoom: 67%;" />

## 2.8.FTP

* FTP协议及其特点：
  * FTP文件传输协议是在互联网两个主机间实现文件互传的网络应用；
  * 特点：
    * C/S模式；
    * 属于带外控制协议，也就是建立2个tcp连接；
    * 通过服务端的tcp21号端口建立控制连接，用来传输控制信息，持久连接；
    * 通过服务端的tcp20号端口建立数据连接，用来传输文件信息，非持久连接；
    * 有状态协议，对每个进行中的用户会话的状态信息进行追踪；
    * 从客户端到服务器的命令和从服务器到客户端的应答都是以7位ASCII码格式在控制连接上传输的。
* FTP协议常见命令：
  * USER：用于向服务器发送用户标识；
  * PASS：用于向服务器发送用户口令；
  * LIST：用于从服务器获取当前目录下的文件列表；
  * RETR：用于从服务器的当前目录下载文件；
  * STOR：用于向服务器的当前目录上传文件。

## 2.9.P2P

* P2P应用特点：

  * 对服务器的依赖很小；
  * 应用动态的在对等方之间进行，具有很强的应用规模伸缩性；
  * 充分聚集利用了端系统（对等方主机）的计算能力以及网络传输带宽。

* P2P文件分发应用时间：

  * p2p结构实现文件分发的最快时间几乎不会随着用户数量的增加而显著增加，当用户数据足够多时，最快分发时间趋近于一个常量。C/S结构下文件分发的时间随客户数量的增加而线性增减；

  * 采用C/S体系结构实现文件分发的最小时间：
    $$
    D_{cs}=max\{nF/u_s,F/d_{min}\}
    $$

    $$
    dmin=min\{d_i|i\in[1,n]\}
    $$

    > F表示要分发的文件，us为服务器接入网络链路的上行带宽，di表示第i个用户主机接入网络链路的下行带宽。

  * 采用P2P体系结构实现文件分发的最小时间：
    $$
    D_{p2p}=max\{F/u_s,F/d_{min},nF/(u_s+\sum^{n}_{i=1}{u_i})\}
    $$

    $$
    dmin=min\{d_i|i\in[1,n]\}
    $$

    若us=ui=u，则公式为：
    $$
    D_{p2p}=max\{F/u,F/d_{min},{\frac{n}{n+1}}\cdot{\frac{F}{u}}\}
    $$

    > F表示要分发的文件，us为服务器接入网络链路的上行带宽，di为第i个用户主机接入网络链路的下行带宽，ui为第i个用户主机接入网络链路的上行带宽。

  * 例：考虑向N个对等方（用户）分发F=15 Gb的一个文件。该服务器具有us=30 Mbit/s的上传速率，每个对等方的下载速度di=2 Mbit/s，上传速率为u。请分别针对客户/服务器分发模式和P2P分发模式两种情况，对于N=10、100 和 1000 以及 u=500 kbit/s、1 Mbit/s和2 Mbit/s的每种组合，绘制最小分发时间图表（注：K=103、M=106、G=109）。

    ```
    
    ```

## 2.10.Socket编程基础

* socket基本概念：
  * 因特网中应用最为广泛的网络应用编程接口，实现与底层协议接口；
  * 分类：
    * 数据报类型套接字SOCK_DGRAM（面向UDP接口）；
    * 流式套接字SOCK_STREAM（面向TCP接口）；
    * 原始套接字SOCK_RAW（面向网络层协议接口）。
* 主要socket api系统调用及其过程：
  * 创建套接字：socke() 函数；
  * 端点地址绑定：bind() 函数；
  * 发送数据：send() 函数；
  * 接收数据：recv() 函数；
  * 释放套接字：close() 函数。
* socket api函数：
  * listen() 监听，accept() 建立连接，只能用于服务器；
  * connect() 主动连接，只能用于客户端；
  * 基于UDP数据发送与接收的函数：sendto()，recvfrom()。